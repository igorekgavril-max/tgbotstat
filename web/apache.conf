# Конфигурация Apache для TGBotStat
# Разместите этот файл в /etc/apache2/sites-available/tgbotstat.conf
# и активируйте: a2ensite tgbotstat

<VirtualHost *:80>
    ServerName your-domain.com  # Замените на ваш домен или IP
    DocumentRoot /path/to/TGBotStat/web  # Замените на реальный путь к проекту

    # Логи
    ErrorLog ${APACHE_LOG_DIR}/tgbotstat_error.log
    CustomLog ${APACHE_LOG_DIR}/tgbotstat_access.log combined

    # Обслуживание index.html для корневого пути
    <Directory /path/to/TGBotStat/web>
        Options -Indexes +FollowSymLinks
        AllowOverride None
        Require all granted
        DirectoryIndex index.html
    </Directory>

    # Проксирование к NiceGUI через /app
    ProxyPreserveHost On
    ProxyRequests Off

    # WebSocket поддержка для /app
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteCond %{REQUEST_URI} ^/app [NC]
    RewriteRule ^/app/?(.*) "ws://127.0.0.1:8080/$1" [P,L]

    # Проксирование /app к NiceGUI
    ProxyPass /app http://127.0.0.1:8080/
    ProxyPassReverse /app http://127.0.0.1:8080/

    # Проксирование /_nicegui (статические файлы NiceGUI)
    ProxyPass /_nicegui http://127.0.0.1:8080/_nicegui
    ProxyPassReverse /_nicegui http://127.0.0.1:8080/_nicegui

    # Заголовки для проксирования
    RequestHeader set X-Forwarded-Proto "http"
    RequestHeader set X-Forwarded-Port "80"
</VirtualHost>

# Для включения модулей Apache выполните:
# sudo a2enmod proxy
# sudo a2enmod proxy_http
# sudo a2enmod rewrite
# sudo a2enmod headers
# sudo systemctl restart apache2
